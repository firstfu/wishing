# 許願池頁面結構產品需求文檔 (PRD)

## 1. 文檔目的

本文檔旨在詳細描述「許願池」專案的頁面結構、功能與使用者流程，作為設計和開發團隊的參考指南。此文檔基於現有的產品需求、API 設計與資料庫結構，提供完整的頁面規劃。

## 2. 專案概述

「許願池」是一個讓用戶發布需求並與潛在提供者建立聯繫的平台。用戶可以支付少量費用張貼自己的需求，其他用戶可以瀏覽並與發布者聯繫以滿足這些需求。平台採用 Next.js 15，使用 App Router 架構實現。

## 3. 頁面結構總覽

### 3.1 主要頁面

| 頁面路徑                     | 頁面名稱 | 頁面描述                         | 訪問權限 |
| ---------------------------- | -------- | -------------------------------- | -------- |
| `/`                          | 首頁     | 展示置頂與最新許願，提供分類瀏覽 | 公開     |
| `/wishes`                    | 許願列表 | 所有許願的列表，支援搜尋與篩選   | 公開     |
| `/wishes/[id]`               | 許願詳情 | 單個許願的詳細資訊與留言區       | 公開     |
| `/wishes/create`             | 發布許願 | 使用者發布新許願的表單           | 登入用戶 |
| `/profile`                   | 個人中心 | 用戶個人資訊與相關許願           | 登入用戶 |
| `/profile/wishes`            | 我的許願 | 使用者發布的所有許願             | 登入用戶 |
| `/profile/messages`          | 我的訊息 | 使用者的所有對話列表             | 登入用戶 |
| `/profile/messages/[userId]` | 對話詳情 | 與特定用戶的訊息對話             | 登入用戶 |
| `/profile/transactions`      | 交易紀錄 | 用戶的所有交易紀錄               | 登入用戶 |
| `/auth/login`                | 登入     | 用戶登入頁面                     | 公開     |
| `/auth/register`             | 註冊     | 用戶註冊頁面                     | 公開     |

### 3.2 全域元件

| 元件名稱         | 描述                                                       | 出現位置                 |
| ---------------- | ---------------------------------------------------------- | ------------------------ |
| `Navbar`         | 頂部導航欄，包含 Logo、搜尋欄、登入/註冊按鈕與發布許願按鈕 | 所有頁面                 |
| `Footer`         | 頁尾，包含網站資訊與連結                                   | 所有頁面                 |
| `WishCard`       | 許願卡片，展示許願的基本資訊                               | 首頁、許願列表、個人中心 |
| `LoadingSpinner` | 載入指示器                                                 | 動態載入資料的頁面       |
| `Toast`          | 訊息提示組件                                               | 全域狀態提示             |
| `Modal`          | 彈出對話框                                                 | 登入提示等情境           |

## 4. 詳細頁面規格

### 4.1 首頁 (`/`)

**描述**：網站主頁，展示置頂許願與最新許願，提供分類導航。

**使用者流程**：

1. 用戶訪問網站首頁
2. 瀏覽熱門分類、置頂許願與最新許願
3. 點擊感興趣的許願查看詳情
4. 點擊「發布許願」按鈕發布自己的需求

**功能需求**：

- 頂部導航欄：Logo、搜尋框、登入/註冊按鈕、發布許願按鈕
- 熱門分類區：展示所有可用分類標籤
- 置頂許願區：輪播展示已支付置頂費用的許願
- 最新許願區：網格或列表形式展示最新發布的許願
- 無限滾動或分頁加載更多許願

**交互設計**：

- 點擊許願卡片：跳轉至對應許願詳情頁
- 點擊分類標籤：跳轉至帶有該分類篩選的許願列表頁
- 點擊發布許願（未登入）：彈出登入提示
- 點擊發布許願（已登入）：跳轉至發布許願頁

**API 依賴**：

- `GET /api/v1/wishes`: 獲取許願列表，帶有 `is_pinned`、`limit` 參數
- `GET /api/v1/categories`: 獲取分類列表

### 4.2 許願列表頁 (`/wishes`)

**描述**：展示所有許願的列表頁面，提供高級搜尋與篩選功能。

**使用者流程**：

1. 用戶進入許願列表頁
2. 使用篩選條件縮小搜尋範圍
3. 瀏覽符合條件的許願
4. 點擊感興趣的許願查看詳情

**功能需求**：

- 高級搜尋區：關鍵字搜尋、分類篩選、價格範圍篩選、狀態篩選
- 排序選項：最新、最舊、價格高低等
- 視圖切換：網格/列表視圖
- 許願列表：顯示許願卡片，包含標題、簡短描述、價格範圍、發布時間等
- 分頁或無限滾動加載

**交互設計**：

- 調整篩選條件：動態更新許願列表
- 切換排序方式：重新排序許願列表
- 切換視圖模式：在網格與列表視圖間切換
- 點擊許願卡片：跳轉至許願詳情頁

**API 依賴**：

- `GET /api/v1/wishes`: 獲取許願列表，帶有分頁、搜尋、排序等參數
- `GET /api/v1/categories`: 獲取分類列表用於篩選

### 4.3 許願詳情頁 (`/wishes/[id]`)

**描述**：展示單個許願的詳細資訊，包括留言區與聯繫功能。

**使用者流程**：

1. 用戶進入許願詳情頁
2. 查看許願詳細描述與圖片
3. 閱讀其他用戶的留言
4. 發表留言或直接聯繫發布者

**功能需求**：

- 許願詳細資訊：標題、分類、詳細描述、預算範圍、截止日期、發布時間
- 發布者資訊：頭像、用戶名、發布時間
- 圖片展示區（如有）
- 留言區：已有留言列表與發表留言表單
- 聯繫發布者按鈕

**交互設計**：

- 點擊「聯繫發布者」（未登入）：彈出登入提示
- 點擊「聯繫發布者」（已登入）：導向私訊對話頁面
- 提交留言：登入狀態下可發表留言
- 發布者查看自己許願：顯示編輯與刪除按鈕

**API 依賴**：

- `GET /api/v1/wishes/{wish_id}`: 獲取許願詳情
- `GET /api/v1/wishes/{wish_id}/comments`: 獲取許願留言
- `POST /api/v1/wishes/{wish_id}/comments`: 發表留言
- `POST /api/v1/messages`: 發送私訊（聯繫發布者）

### 4.4 發布許願頁 (`/wishes/create`)

**描述**：讓用戶發布新許願的表單頁面，包含支付流程。

**使用者流程**：

1. 用戶點擊「發布許願」進入頁面
2. 填寫許願詳細資訊
3. 選擇是否置頂
4. 確認費用並進行支付
5. 許願發布成功

**功能需求**：

- 許願表單：標題、分類選擇、詳細描述、預算範圍、截止日期
- 圖片上傳功能：允許上傳一張或多張圖片
- 置頂選項：額外付費選項，顯示費用說明
- 費用計算區：基本發布費用、置頂費用（如選擇）、總計
- 發布按鈕：提交表單並跳轉至支付流程

**交互設計**：

- 表單驗證：即時驗證必填欄位與格式
- 圖片預覽：上傳後可預覽並刪除
- 置頂選項切換：更新費用計算
- 確認發布：彈出支付確認框
- 支付完成：顯示成功訊息，跳轉至許願詳情頁

**API 依賴**：

- `GET /api/v1/categories`: 獲取分類列表
- `POST /api/v1/wishes`: 發布新許願
- `POST /api/v1/transactions/deposit`: 處理支付（如餘額不足）

### 4.5 個人中心頁 (`/profile`)

**描述**：用戶的個人中心，展示個人資訊與相關數據摘要。

**使用者流程**：

1. 用戶登入後進入個人中心
2. 查看個人資訊與帳戶餘額
3. 瀏覽最近發布的許願與訊息
4. 導航至詳細功能頁面

**功能需求**：

- 用戶資訊卡：頭像、用戶名、註冊時間
- 帳戶餘額與儲值按鈕
- 我的許願摘要：顯示最近發布的許願（3-4 條）
- 我的訊息摘要：顯示最近的對話（3-4 條）
- 快速導航：前往完整的許願列表、訊息中心、交易記錄頁面

**交互設計**：

- 點擊儲值按鈕：顯示儲值頁面
- 點擊「查看全部」：跳轉至對應的詳細頁面
- 點擊許願卡片：跳轉至許願詳情
- 點擊訊息：跳轉至對話頁面

**API 依賴**：

- `GET /api/v1/users/me`: 獲取當前用戶資訊
- `GET /api/v1/wishes?user_id={current_user_id}`: 獲取用戶發布的許願
- `GET /api/v1/messages/conversations`: 獲取用戶的對話列表

### 4.6 我的許願頁 (`/profile/wishes`)

**描述**：顯示用戶發布的所有許願及其狀態。

**使用者流程**：

1. 從個人中心導航至「我的許願」
2. 查看所有發布的許願及其狀態
3. 管理已發布的許願（編輯、刪除、置頂）

**功能需求**：

- 狀態篩選標籤：全部、進行中、已完成、已過期
- 許願列表：顯示每條許願的標題、簡短描述、發布時間、狀態
- 操作按鈕：編輯、刪除、置頂（付費）
- 分頁或無限滾動

**交互設計**：

- 切換狀態標籤：篩選對應狀態的許願
- 點擊編輯：跳轉至編輯許願頁面
- 點擊刪除：顯示確認對話框
- 點擊置頂：顯示置頂費用確認與支付頁面

**API 依賴**：

- `GET /api/v1/wishes?user_id={current_user_id}`: 獲取用戶發布的許願
- `PUT /api/v1/wishes/{wish_id}`: 更新許願信息
- `DELETE /api/v1/wishes/{wish_id}`: 刪除許願
- `POST /api/v1/wishes/{wish_id}/pin`: 置頂許願

### 4.7 我的訊息頁 (`/profile/messages`)

**描述**：用戶的訊息中心，顯示所有對話列表。

**使用者流程**：

1. 從個人中心導航至「我的訊息」
2. 查看所有對話列表
3. 點擊特定對話進入對話詳情

**功能需求**：

- 對話列表：顯示對話用戶的頭像、名稱、最後一條訊息預覽、時間
- 未讀訊息提示：高亮顯示未讀訊息數量
- 按最後訊息時間排序
- 相關許願資訊（如有）

**交互設計**：

- 點擊對話：跳轉至對話詳情頁
- 收到新訊息：實時更新列表與未讀計數
- 搜尋或篩選對話（可選功能）

**API 依賴**：

- `GET /api/v1/messages/conversations`: 獲取用戶的對話列表

### 4.8 對話詳情頁 (`/profile/messages/[userId]`)

**描述**：與特定用戶的一對一訊息對話頁面。

**使用者流程**：

1. 從訊息列表點擊特定對話
2. 查看歷史訊息
3. 發送新訊息
4. 可能查看或導航至相關許願

**功能需求**：

- 對話頂部：對方用戶資訊（頭像、名稱）與相關許願連結（如有）
- 訊息歷史：顯示雙方發送的所有訊息，包含時間戳
- 訊息輸入區：文字輸入框與發送按鈕
- 已讀/未讀狀態顯示

**交互設計**：

- 滾動加載更多歷史訊息
- 發送訊息：即時顯示在對話區
- 接收訊息：即時顯示，無需刷新
- 點擊許願連結：導航至相關許願頁面

**API 依賴**：

- `GET /api/v1/messages/conversations/{user_id}`: 獲取與特定用戶的對話
- `POST /api/v1/messages`: 發送新訊息
- `PUT /api/v1/messages/read`: 標記訊息為已讀

### 4.9 交易紀錄頁 (`/profile/transactions`)

**描述**：顯示用戶的所有交易歷史記錄。

**使用者流程**：

1. 從個人中心導航至「交易紀錄」
2. 瀏覽所有交易歷史
3. 根據需要篩選特定類型交易

**功能需求**：

- 交易類型篩選：全部、儲值、許願發布、置頂
- 交易列表：顯示交易類型、金額、狀態、時間、相關許願（如有）
- 交易詳情展開功能
- 分頁或無限滾動加載

**交互設計**：

- 篩選交易類型：更新列表顯示
- 點擊交易項：展開/收起詳細信息
- 點擊相關許願：跳轉至許願詳情頁

**API 依賴**：

- `GET /api/v1/transactions`: 獲取用戶交易記錄

### 4.10 登入頁 (`/auth/login`)

**描述**：用戶登入頁面。

**使用者流程**：

1. 進入登入頁面
2. 輸入電子郵件與密碼
3. 提交登入
4. 成功後重定向至首頁或預期頁面

**功能需求**：

- 登入表單：電子郵件輸入框、密碼輸入框
- 記住我選項
- 忘記密碼連結
- 社交媒體登入選項（如 Google、Facebook）
- 註冊頁面導航連結

**交互設計**：

- 表單驗證：即時檢查輸入格式
- 提交表單：顯示載入狀態
- 登入失敗：顯示錯誤訊息
- 登入成功：重定向至適當頁面

**API 依賴**：

- `POST /api/v1/auth/login`: 用戶登入

### 4.11 註冊頁 (`/auth/register`)

**描述**：新用戶註冊頁面。

**使用者流程**：

1. 進入註冊頁面
2. 填寫註冊資訊
3. 提交註冊
4. 成功後重定向至首頁或歡迎頁面

**功能需求**：

- 註冊表單：用戶名、電子郵件、密碼、確認密碼
- 服務條款與隱私政策同意選項
- 社交媒體註冊選項（如 Google、Facebook）
- 登入頁面導航連結

**交互設計**：

- 表單驗證：即時檢查輸入格式、用戶名與電子郵件可用性
- 提交表單：顯示載入狀態
- 註冊失敗：顯示錯誤訊息
- 註冊成功：重定向至首頁或歡迎頁面

**API 依賴**：

- `POST /api/v1/auth/register`: 用戶註冊

## 5. 技術實現方案

### 5.1 頁面實現技術

- **框架**：Next.js 15.3（App Router）
- **頁面類型**：
  - 靜態元素：React Server Components (RSC)
  - 動態交互：Client Components
- **樣式**：Tailwind CSS 實現響應式設計
- **動畫**：Framer Motion 用於過渡動畫

### 5.2 數據獲取策略

- **靜態內容**：使用靜態生成 (SSG)
- **動態內容**：使用服務器端渲染 (SSR)
- **用戶特定內容**：使用客戶端渲染 + API 調用
- **數據緩存**：SWR 或 React Query 進行數據獲取和緩存

### 5.3 狀態管理

- **全域狀態**：React Context API
- **伺服器資料**：SWR 或 React Query
- **表單處理**：React Hook Form + Zod 驗證

### 5.4 頁面路由結構

```
app/
│
├── page.tsx                   # 首頁
├── layout.tsx                 # 根布局
├── globals.css                # 全局樣式
│
├── wishes/                    # 許願相關頁面
│   ├── page.tsx               # 許願列表頁
│   ├── create/
│   │   └── page.tsx           # 發布許願頁
│   └── [id]/
│       └── page.tsx           # 許願詳情頁
│
├── profile/                   # 個人中心相關頁面
│   ├── page.tsx               # 個人中心主頁
│   ├── wishes/
│   │   └── page.tsx           # 我的許願頁
│   ├── messages/
│   │   ├── page.tsx           # 訊息中心頁
│   │   └── [userId]/
│   │       └── page.tsx       # 對話詳情頁
│   └── transactions/
│       └── page.tsx           # 交易紀錄頁
│
├── auth/                      # 認證相關頁面
│   ├── login/
│   │   └── page.tsx           # 登入頁
│   └── register/
│       └── page.tsx           # 註冊頁
│
└── api/                       # API 路由
    └── v1/
        ├── auth/              # 認證相關API
        ├── users/             # 用戶相關API
        ├── wishes/            # 許願相關API
        ├── comments/          # 留言相關API
        ├── messages/          # 訊息相關API
        ├── transactions/      # 交易相關API
        └── categories/        # 分類相關API
```

## 6. 元件設計

### 6.1 元件結構

```
components/
│
├── layouts/                   # 布局組件
│   ├── Navbar.tsx             # 導航欄
│   └── Footer.tsx             # 頁尾
│
├── ui/                        # UI基礎組件
│   ├── Button.tsx
│   ├── Input.tsx
│   ├── Select.tsx
│   ├── Modal.tsx
│   ├── Toast.tsx
│   └── LoadingSpinner.tsx
│
├── wishes/                    # 許願相關組件
│   ├── WishCard.tsx           # 許願卡片
│   ├── WishForm.tsx           # 許願表單
│   ├── WishFilters.tsx        # 許願篩選器
│   └── WishComments.tsx       # 許願留言區
│
├── profile/                   # 個人中心相關組件
│   ├── UserInfo.tsx           # 用戶信息
│   ├── UserStats.tsx          # 用戶統計
│   ├── MessageList.tsx        # 訊息列表
│   └── TransactionList.tsx    # 交易列表
│
└── auth/                      # 認證相關組件
    ├── LoginForm.tsx          # 登入表單
    └── RegisterForm.tsx       # 註冊表單
```

### 6.2 主要元件說明

- **WishCard**：許願卡片組件，用於首頁、列表頁展示許願摘要

  - 內容：標題、簡短描述、價格範圍、發布時間、發布者資訊
  - 變體：小卡片（首頁用）、標準卡片（列表頁用）、詳細卡片（個人中心用）

- **Navbar**：頂部導航組件

  - 內容：Logo、搜尋框、登入/註冊按鈕、發布許願按鈕
  - 響應式：桌面版展開式、移動版收縮為漢堡選單

- **WishForm**：許願表單組件

  - 功能：用於發布新許願或編輯現有許願
  - 表單項：標題、分類、描述、預算、截止日期、圖片上傳

- **MessageList**：訊息列表組件
  - 功能：顯示對話列表與最後一條訊息預覽
  - 樣式：未讀訊息高亮、時間戳、相關許願資訊

## 7. 響應式設計策略

### 7.1 斷點設定

- 行動裝置：< 640px
- 平板：640px - 1024px
- 桌面：> 1024px

### 7.2 行動裝置適配

- 單欄布局
- 底部固定操作欄
- 簡化導航為漢堡選單
- 觸控友好的大按鈕

### 7.3 平板適配

- 雙欄布局
- 側邊導航可折疊
- 平衡觸控與滑鼠操作

### 7.4 桌面適配

- 多欄布局
- 展開式導航
- 快捷鍵支持
- 懸浮效果增強

## 8. 性能優化計劃

### 8.1 初始載入優化

- 核心元素優先渲染
- 圖片懶加載
- 關鍵 CSS 內聯
- 按需加載元件

### 8.2 運行時優化

- 虛擬列表渲染（長列表）
- 請求去重與合併
- 數據緩存策略
- 防抖與節流

### 8.3 構建優化

- 代碼分割
- Tree shaking
- 靜態資源優化
- 預取關鍵路由

## 9. 未來擴展計劃

### 9.1 階段二功能頁面

- 通知中心頁面
- 用戶評價系統頁面
- 管理員後台頁面

### 9.2 階段三功能頁面

- 專業服務提供者認證頁面
- 國際化支持頁面
- 移動應用界面原型

## 10. 風險評估

### 10.1 技術風險

- 大量並發訪問的性能挑戰
- 實時通訊的穩定性
- 移動端相容性問題

### 10.2 緩解策略

- 實施漸進式加載策略
- 建立備用通訊機制
- 全面的跨裝置測試
